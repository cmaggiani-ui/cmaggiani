<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PitchScore â€” Evaluador de ideas de pelÃ­cula (HTML)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --bg:#f8fafc; --panel:#ffffff; --ink:#0f172a; --muted:#475569; --border:#e2e8f0; }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans",sans-serif;background:linear-gradient(#f8fafc,#fff);color:var(--ink)}
    .container{max-width:1200px;margin:0 auto;padding:24px}
    .grid{display:grid;gap:24px}
    @media(min-width:1024px){.grid{grid-template-columns:1fr 2fr}}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:16px;box-shadow:0 10px 25px rgba(2,6,23,.04);padding:20px}
    .title{font-weight:700;font-size:28px;margin:4px 0}
    .subtitle{color:var(--muted)}
    textarea,input,select,button{font:inherit}
    textarea{width:100%;height:160px;padding:12px;border:1px solid var(--border);border-radius:12px;resize:vertical}
    input[type="number"],select{width:100%;padding:10px;border:1px solid var(--border);border-radius:12px}
    .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
    .chip{padding:6px 10px;border:1px solid var(--border);border-radius:999px;background:#fff;cursor:pointer}
    .chip.active{background:#0f172a;color:#fff;border-color:#0f172a}
    .btn{width:100%;padding:12px 16px;border:0;border-radius:12px;background:#0f172a;color:#fff;font-weight:700;cursor:pointer}
    .btn[disabled]{opacity:.5;cursor:not-allowed}
    .muted{color:var(--muted);font-size:12px}
    table{width:100%;border-collapse:collapse}
    th,td{text-align:left;padding:10px}
    tbody tr{border-top:1px solid var(--border)}
    .gaugeWrap{display:flex;align-items:center;justify-content:center}
    .kpi{font-weight:700;font-size:22px}
    .row{display:grid;gap:16px;grid-template-columns:1fr 1fr}
    @media(max-width:640px){.row{grid-template-columns:1fr}}
    footer{color:#64748b;font-size:12px;margin-top:24px}
  </style>
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
  <header class="container">
    <h1 class="title">ðŸŽ¬ PitchScore â€” Evaluador de ideas de pelÃ­cula</h1>
    <p class="subtitle">Escribe tu idea, obtÃ©n una probabilidad de Ã©xito, fortalezas/debilidades y pelÃ­culas similares. (Demo educativa en HTML, sin backend)</p>
  </header>

  <main class="container grid">
    <!-- Formulario -->
    <section class="card">
      <h2 style="margin:0 0 12px 0;font-size:20px;font-weight:700">1) Describe tu idea</h2>
      <form id="form">
        <label>
          <span class="muted">Pitch / logline (2â€“5 pÃ¡rrafos)</span>
          <textarea id="pitch" placeholder="Una cientÃ­fica crea una IA sensible que invita a un extraÃ±o experimento..."></textarea>
        </label>

        <div class="row" style="margin-top:12px">
          <label>
            <span class="muted">Rating</span>
            <select id="rating">
              <option>G</option>
              <option>PG</option>
              <option selected>PG-13</option>
              <option>R</option>
              <option>NC-17</option>
            </select>
          </label>
          <label>
            <span class="muted">Tono (opcional)</span>
            <select id="tone">
              <option value="">â€”</option>
              <option>luminoso</option>
              <option>oscuro</option>
              <option>feelâ€‘good</option>
              <option>satÃ­rico</option>
              <option>Ã©pico</option>
              <option>Ã­ntimo</option>
            </select>
          </label>
        </div>

        <div style="margin-top:12px">
          <span class="muted">GÃ©nero(s)</span>
          <div id="genres" class="chips"></div>
          <p class="muted">Si no seleccionas, se intentarÃ¡ inferir desde el texto.</p>
        </div>

        <label style="display:block;margin-top:12px">
          <span class="muted">Presupuesto objetivo (USD, opcional)</span>
          <input id="budget" type="number" min="0" step="100000" placeholder="12000000" />
        </label>

        <button id="submitBtn" type="submit" class="btn" style="margin-top:12px">Evaluar</button>
        <p id="genreGuess" class="muted" style="margin-top:8px;display:none"></p>
      </form>
    </section>

    <!-- Resultados -->
    <section class="grid" style="grid-template-columns:1fr;gap:24px">
      <!-- Gauge + resumen -->
      <div class="card" style="min-height:220px">
        <div id="emptyState" class="muted">Rellena el formulario y pulsa "Evaluar" para ver resultados.</div>
        <div id="summary" style="display:none">
          <div class="row">
            <div class="gaugeWrap">
              <canvas id="gauge" width="340" height="170" aria-label="probabilidad de Ã©xito"></canvas>
            </div>
            <div>
              <h3 style="margin:0 0 6px 0;font-size:18px;font-weight:700">Resultado</h3>
              <p class="subtitle" id="percentilText"></p>
              <ul style="margin:10px 0 0 18px;color:#111827;font-size:14px">
                <li><strong>Fortalezas</strong>: <span id="strengths">â€”</span></li>
                <li><strong>A mejorar</strong>: <span id="weaknesses">â€”</span></li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- Radar -->
      <div class="card">
        <h3 style="margin:0 0 8px 0;font-size:18px;font-weight:700">Perfil creativo</h3>
        <canvas id="radar" height="260"></canvas>
      </div>

      <!-- Drivers -->
      <div class="card">
        <h3 style="margin:0 0 8px 0;font-size:18px;font-weight:700">Â¿QuÃ© impulsa tu score?</h3>
        <canvas id="bars" height="260"></canvas>
      </div>

      <!-- Similares -->
      <div class="card">
        <h3 style="margin:0 0 8px 0;font-size:18px;font-weight:700">PelÃ­culas similares</h3>
        <div style="overflow:auto">
          <table>
            <thead>
              <tr style="color:var(--muted)">
                <th>TÃ­tulo</th>
                <th>AÃ±o</th>
                <th>Similitud</th>
                <th>ROI</th>
              </tr>
            </thead>
            <tbody id="simTable">
              <tr><td colspan="4" class="muted">AÃºn no hay resultados.</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  <footer class="container">
    Demo educativa: los valores son simulados. Sustituye el mock por tu modelo/endpoint real.
  </footer>

  <script>
    // ======= Datos base =======
    const GENRES = ["AcciÃ³n","Aventura","Comedia","Drama","Romance","Terror","Sciâ€‘Fi","Thriller","Fantasia","AnimaciÃ³n"];
    const KEYMAP = [
      { k: /space|nave|planeta|robot|ia|inteligencia artificial|futuro|alien/gi, g: "Sciâ€‘Fi" },
      { k: /crimen|asesin|investigaci|misterio|conspiraci|persecuci/gi, g: "Thriller" },
      { k: /risa|chiste|comedia|humor|torpe|situaci/gi, g: "Comedia" },
      { k: /amor|relaci|pareja|romance|coraz/gi, g: "Romance" },
      { k: /magia|reino|hechic|drag|fantas/gi, g: "Fantasia" },
      { k: /miedo|fantasma|demon|pose|slasher|terror/gi, g: "Terror" },
      { k: /batalla|guerra|rebel|conflicto|misiÃ³n|acciÃ³n/gi, g: "AcciÃ³n" },
      { k: /viaje|bÃºsqueda|tesoro|aventur/gi, g: "Aventura" },
      { k: /animaci|dibujo|stop motion/gi, g: "AnimaciÃ³n" },
      { k: /drama|familia|superar|enfermedad|duelo/gi, g: "Drama" },
    ];

    // ======= Utilidades =======
    function el(id){return document.getElementById(id)}
    function hashScore(str){ let h=0; for(let i=0;i<str.length;i++) h=(h*31+str.charCodeAt(i))>>>0; return h; }
    function pickGenresFromText(text){ const m=new Map(); for(const {k,g} of KEYMAP){ const r=text.match(k); if(r&&r.length) m.set(g,(m.get(g)||0)+r.length);} return [...m.entries()].sort((a,b)=>b[1]-a[1]).map(([g])=>g) }
    function pct(n){ return Math.round(n*100) }

    // ======= Mock del modelo =======
    async function mockScoreRequest(pitch, options){
      await new Promise(r=>setTimeout(r,450));
      const base = Math.min(0.4 + (Math.tanh((pitch.length - 400) / 600) + 1) * 0.25, 0.95);
      const h = hashScore(pitch + JSON.stringify(options));
      const guessed = pickGenresFromText(pitch);
      const genres = options.genres?.length ? options.genres : (guessed.length ? guessed.slice(0,2) : ["Drama"]);
      const genreAdj = genres.reduce((acc,g)=>acc+({"Comedia":0.03,"Sciâ€‘Fi":0.02,"Terror":0.00,"Drama":-0.01,"Romance":-0.02,"Thriller":0.01,"AcciÃ³n":0.01}[g]||0),0);
      const budget = options.budget_hint_usd ?? (/\b(space|batalla|drag|epic|guerra)\b/i.test(pitch) ? 40000000 : 8000000);
      const budgetPeer = (genres.includes("Sciâ€‘Fi")||genres.includes("AcciÃ³n")||genres.includes("Fantasia")) ? 30000000 : 8000000;
      const budgetFeasibility = Math.max(0, Math.min(1, 1 - Math.abs(budget - budgetPeer)/Math.max(1,budgetPeer*2)));
      const originality = Math.max(0, Math.min(1, ((h % 100)/100)*0.6 + (new Set(genres).size>=2 ? 0.2 : 0.05)));
      const clarity = Math.max(0, Math.min(1, 0.5 + ((h>>5)%50)/150));
      const audience = Math.max(0, Math.min(1, 0.4 + (genres.includes("Comedia")||genres.includes("Terror")?0.1:0) + ((h>>7)%30)/200));
      const productionRisk = Math.max(0, 1 - budgetFeasibility*0.7 - ((h>>9)%20)/100);
      const p_success = Math.max(0.05, Math.min(0.95, base + genreAdj + (originality-0.5)*0.15 + (audience-0.5)*0.12 + (budgetFeasibility-0.5)*0.18 - (productionRisk-0.5)*0.15));
      const drivers = [
        { feature: genres.join("+"), impact: +(genreAdj).toFixed(3) },
        { feature: "originality_index", impact: +((originality-0.5)*0.15).toFixed(3) },
        { feature: "audience_appeal", impact: +((audience-0.5)*0.12).toFixed(3) },
        { feature: "budget_vs_peers", impact: +((budgetFeasibility-0.5)*0.18).toFixed(3) },
        { feature: "production_risk", impact: -+((productionRisk-0.5)*0.15).toFixed(3) },
      ].sort((a,b)=>Math.abs(b.impact)-Math.abs(a.impact));
      const pool=[
        { title:"Ex Machina", year:2014, roi:3.7 },
        { title:"Annihilation", year:2018, roi:1.4 },
        { title:"Get Out", year:2017, roi:7.1 },
        { title:"A Quiet Place", year:2018, roi:5.4 },
        { title:"Her", year:2013, roi:2.9 },
        { title:"Crazy Rich Asians", year:2018, roi:7.3 },
        { title:"Parasite", year:2019, roi:20.0 },
        { title:"Knives Out", year:2019, roi:4.2 },
        { title:"Mad Max: Fury Road", year:2015, roi:2.7 },
        { title:"The Conjuring", year:2013, roi:13.3 },
      ];
      const sims=pool.map((m,i)=>({...m, similarity:+(0.6+((h>>(i+1))%35)/100).toFixed(2)})).sort((a,b)=>b.similarity-a.similarity).slice(0,5);
      return { p_success, radar:{originality,clarity,audience_appeal:audience,budget_feasibility:budgetFeasibility,production_risk:productionRisk}, drivers, nearest_movies:sims, meta:{genreGuess:genres} };
    }

    // ======= GÃ©neros (chips) =======
    const genresWrap = el('genres');
    const selected = new Set();
    GENRES.forEach(g=>{
      const b=document.createElement('button'); b.type='button'; b.className='chip'; b.textContent=g;
      b.onclick=()=>{ if(selected.has(g)){selected.delete(g); b.classList.remove('active');} else {selected.add(g); b.classList.add('active');} };
      genresWrap.appendChild(b);
    });

    // ======= GrÃ¡ficas (Chart.js) =======
    let gaugeChart, radarChart, barsChart;
    function renderGauge(value){
      const ctx = el('gauge').getContext('2d');
      if(gaugeChart) gaugeChart.destroy();
      gaugeChart = new Chart(ctx, {
        type:'doughnut',
        data:{ labels:['Score','Rest'], datasets:[{ data:[value, 1-value] }] },
        options:{ rotation:-90, circumference:180, cutout:'70%', plugins:{ legend:{display:false}, tooltip:{enabled:false}}, responsive:true, animation:{duration:600} }
      });
      // Aguja
      const centerX = ctx.canvas.width/2; const centerY = ctx.canvas.height; const radius = ctx.canvas.height*0.9;
      const angle = Math.PI * value; // 0..1 â†’ 0..Ï€
      const x = centerX + radius * Math.cos(Math.PI - angle);
      const y = centerY - radius * Math.sin(Math.PI - angle);
      // Dibujar aguja encima
      setTimeout(()=>{ const c=ctx.canvas; const g=c.getContext('2d'); g.save(); g.translate(0,0); g.beginPath(); g.moveTo(centerX,centerY); g.lineTo(x,y); g.lineWidth=3; g.stroke(); g.beginPath(); g.arc(centerX, centerY, 6, 0, Math.PI*2); g.fill(); g.restore(); }, 10);
    }

    function renderRadar(r){
      const ctx = el('radar').getContext('2d');
      if(radarChart) radarChart.destroy();
      radarChart = new Chart(ctx, {
        type:'radar',
        data:{ labels:["Originalidad","Claridad","Atractivo audiencia","Viabilidad presupuesto","Riesgo producciÃ³n (â†“)"] , datasets:[{ data:[r.originality, r.clarity, r.audience_appeal, r.budget_feasibility, 1-r.production_risk], fill:true }] },
        options:{ plugins:{ legend:{display:false} }, scales:{ r:{ min:0,max:1,ticks:{display:false} } } }
      });
    }

    function renderBars(drivers){
      const ctx = el('bars').getContext('2d');
      if(barsChart) barsChart.destroy();
      barsChart = new Chart(ctx, {
        type:'bar',
        data:{ labels: drivers.map(d=>d.feature), datasets:[{ data: drivers.map(d=>d.impact) }] },
        options:{ plugins:{ legend:{display:false}, tooltip:{callbacks:{label:(c)=> ((c.raw*100).toFixed(1)+"%") }} }, scales:{ y:{ suggestedMin:-0.2, suggestedMax:0.2, ticks:{ callback:(v)=> (v*100).toFixed(0)+"%" } } } }
      });
    }

    function renderSimTable(items){
      const tbody = el('simTable');
      tbody.innerHTML = '';
      items.forEach(m=>{
        const tr=document.createElement('tr');
        tr.innerHTML = `<td style="font-weight:600">${m.title}</td><td>${m.year}</td><td>${Math.round(m.similarity*100)}%</td><td>${m.roi? m.roi.toFixed(1)+"Ã—":"â€”"}</td>`;
        tbody.appendChild(tr);
      });
    }

    // ======= InteracciÃ³n =======
    el('form').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const pitch = el('pitch').value.trim();
      if(!pitch){ alert('Escribe tu pitch primero.'); return; }
      el('submitBtn').disabled = true; el('submitBtn').textContent = 'Evaluandoâ€¦';
      const options = { genres:[...selected], tone: el('tone').value || undefined, rating: el('rating').value, budget_hint_usd: el('budget').value ? Number(el('budget').value) : undefined };
      const out = await mockScoreRequest(pitch, options);

      // UI
      el('emptyState').style.display = 'none';
      el('summary').style.display = '';
      el('percentilText').innerHTML = `Tu idea se ubica en el <strong>percentil ${pct(out.p_success)}</strong> de probabilidad estimada de Ã©xito (demo).`;
      const strengths = out.drivers.filter(d=>d.impact>0).slice(0,2).map(d=>d.feature).join(', ') || 'â€”';
      const weaknesses = out.drivers.filter(d=>d.impact<0).slice(0,2).map(d=>d.feature).join(', ') || 'â€”';
      el('strengths').textContent = strengths; el('weaknesses').textContent = weaknesses;
      const gg = out.meta?.genreGuess?.length ? `GÃ©nero inferido: <strong>${out.meta.genreGuess.join(', ')}</strong>` : '';
      el('genreGuess').innerHTML = gg; el('genreGuess').style.display = gg ? '' : 'none';

      renderGauge(out.p_success);
      renderRadar(out.radar);
      renderBars(out.drivers);
      renderSimTable(out.nearest_movies);

      el('submitBtn').disabled = false; el('submitBtn').textContent = 'Evaluar';
    });
  </script>
</body>
</html>
